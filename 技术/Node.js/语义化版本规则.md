在项目中都会有一个package.json，这是一个项目配置文件，里面的配置项很多，这里我们只说有关依赖的版本问题，就是那些版本数字中出现的**`^,~,-`**，这些符号究竟什么意思。

```json
"dependencies": {
    "bcrypt": "^5.0.1",
    "bluebird": "^3.7.2",
    "cors": "^2.8.5",
    "express": "^4.17.1",
    "lodash": "^4.17.21",
    "multer": "^1.4.2",
    "semver": "^7.3.5",
    "sqlite3": "^5.0.2",
    "umzug": "^2.3.0"
}
```

这些符号是所谓的语义化版本规则中定义的，他们的意义各有不同，关于语义化版本相关的资料可以看这里：[Semantic Versioning 2.0.0 | Semantic Versioning](https://semver.org/)

## 版本的组成

版本一般由主版本号(major)，次版本号(minor)，补丁号(patch)组成，`[major,minor,patch]`，如

```shell
5.0.1, 0.0.3, 0.3.1, 3.2
```

有的还带有预发布标签(alpha，beta等)的，像这样的：

```shell
5.0.1-beta.1, 5.0.0-alpha
```

## 比较与结果集

还有常用的比较符有：>，<，>=，<=，= 这些跟小学数学中的表示一样。

比较符通常放到某个版本号前面：`>=1.2.3`，`<2.1.0` 这两个比较操作的意思也很容易看懂。

当我们要表示两个区间交集时，比如从要求满足某个版本到某个版本之间，我们可以用空格关联两个比较操作，如：`>=1.2.7 <1.3.0`，表示只有大于等于1.2.7且小于1.3.0的版本才能满足要求。

当我们要表示两个区间的并集是，即满足A区间或者满足B区间，我们可以用`||`来关联两个比较操作，如：`1.2.7 || >=1.2.9 <2.0.0`，表示版本是1.2.7可以满足，或者是大于等于1.2.9且小于2.0.0的版本也能满足。

## 带预发布标签的版本比较

如果相互比较的版本中带有预发布标签，像这样的：`>1.2.3-alpha.3`，则比较规则有点不同。

**一个带了预发布标签，一个没带的情况，按照正常的从左到右的比较**

```javascript
semver.satisfies('1.2.3', '>1.2.3-alpha.3'); // true
semver.satisfies('1.2.4', '>1.2.3-alpha.3'); // true
semver.satisfies('1.3.2', '>1.2.3-alpha.3'); // true
semver.satisfies('1.1.2', '>1.2.3-alpha.3'); // false
```

两个都带了预发布标签，则要求他们的major，minor，patch必须要相同，然后再比较标签的版本。我们可以用“伪代码”表示：

```javascript
function satisfies(ver1, ver2) {
	const [major1,minor2,patch1,tag1] = ver1;
    const [major2,minor2,patch2,tag2] = ver2;
    if (major1===major2 && minor1===minor2 && patch1===patch2) {
        return satisfiesTag(tag1, tag2);
    }
    return false
}
```

例如：

```javascript
semver.satisfies('1.2.4-alpha.4', '>1.2.3-alpha.3'); // false
semver.satisfies('1.2.3-alpha.4', '>1.2.3-alpha.3'); // true
semver.satisfies('1.2.3-alpha.2', '>1.2.3-alpha.3'); // false
```

## 连字符(-)

最直接的区间表示符号，很容易理解，如：

```shell
1.2.3 - 2.3.4 := >=1.2.3 <=2.3.4
1.2 - 2.3.4 := >=1.2.0 <=2.3.4
1.2.3 - 2.3 := >=1.2.3 <2.4.0-0
1.2.3 - 2 := >=1.2.3 <3.0.0-0
```

## 星号(*)或空格

星号与空格都表示任意版本，它包含了major，minor，patch三个数字，如

```shell
* := >=0.0.0
'' := * := >=0.0.0
```

如果想表示某个数字，而不是整个版本，那么我们可以用大写的X，或者小写的x

```shell
1.x := >=1.0.0 <2.0.0-0
1.2.x := >=1.2.0 <1.3.0-0
1 := 1.x.x := >=1.0.0 <2.0.0-0
1.2 := 1.2.x := >=1.2.0 <1.3.0-0
```

## 波浪线(~)

带波浪线的比较，会根据其后面的版本应用不同的比较规则

**包含major，minor，patch三位数字时，要保证前面两位不能变**

```shell
~1.2.3 := >=1.2.3 <1.3.0-0
~0.2.3 := >=0.2.3 <0.3.0-0
```

**包含major，minor两位数字时，还是要保证前面两位数字不能变**

```shell
~1.2 := >=1.2.0 <1.3.0-0
~0.2 := >=0.2.0 <0.3.0-0
```

**只包含一位major时，保证major不能变**

```shell
~1 := >=1.0.1 <2.0.0-0
~0 := >=0.0.0 <1.0.0-0
```

## 插入符(^)

插入符(^)主要是限制左边起第一个非零的数字不能变，这个数字可能是major，minor，patch中的一个。

```shell
^1.2.3 := >=1.2.3 <2.0.0-0  // 将major限定在1
^0.2.3 := >=0.2.3 <0.3.0-0  // 将minor限定在2，因为major为0
^0.0.3 := >=0.0.3 <0.0.4-0  // 将patch限定在3
^1.2.3-beta.2 := >=1.2.3-beta.2 <2.0.0-0
^1.2.x := >=1.2.0 <2.0.0-0
^0.0.x := >=0.0.0 <0.1.0-0
^0.0 := >=0.0.0 <0.1.0-0
^1.x := >=1.0.0 <2.0.0-0
^0.x := >=0.0.0 <1.0.0-0
```

# 参考

https://semver.org/

https://github.com/npm/node-semver#readme

